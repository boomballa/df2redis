{{ define "content" }}
<div class="hero">
    <div>
        <h1>df2redis Live Dashboard</h1>
        <p class="subtitle">Track Dragonfly â†’ Redis synchronization at a glance.</p>
    </div>
    {{ if .TaskName }}
    <div class="meta-row">
        <div class="meta-pill task-pill">
            <span class="icon">ğŸ·ï¸</span>
            <span>Task: <strong>{{ .TaskName }}</strong></span>
        </div>
    </div>
    {{ end }}
    <div class="meta-row">
        <div class="meta-pill">
            <span class="icon">ğŸ—„ï¸</span>
            <span>Source: <strong>{{ .Source.Type }} @ {{ .Source.Addr }}</strong></span>
        </div>
        <div class="meta-pill">
            <span class="icon">ğŸ¯</span>
            <span>Target: <strong>{{ .Target.Type }} @ {{ .Target.Seed }}</strong></span>
        </div>
    </div>
    <div class="meta-row">
        <div class="meta-pill">
            <span class="icon">ğŸ—‚ï¸</span>
            <span>State: <strong>{{ .StateDir }}</strong></span>
        </div>
        <div class="meta-pill">
            <span class="icon">ğŸ“</span>
            <span>Status: <strong>{{ .StatusFile }}</strong></span>
        </div>
        {{ if .LogDir }}
        <div class="meta-pill">
            <span class="icon">ğŸ“‹</span>
            <span>Logs: <strong>{{ .LogDir }}</strong></span>
        </div>
        {{ end }}
        <div class="meta-pill">
            <span class="icon">â±ï¸</span>
            <span>Updated: <strong>{{ .GeneratedAt }}</strong></span>
        </div>
    </div>
</div>

<div class="grid grid-3" style="margin-top:24px;">
    <div class="card highlight">
        <div class="card-title">Sync Status</div>
        <div class="state-badge" id="pipeline-status">{{ with .Snapshot }}{{ .PipelineStatus }}{{ else }}pending{{ end }}</div>
        <p class="muted" style="margin-top:12px;">Current stage: <strong id="current-stage">incremental</strong></p>
        <p class="muted">Last refresh: <span id="pipeline-updated">{{ with .Snapshot }}{{ .UpdatedAt }}{{ else }}--{{ end }}</span></p>
    </div>
    <div class="card">
        <div class="card-title">Source</div>
        <p class="muted">Type: <strong>{{ .Source.Type }}</strong></p>
        <p class="muted">Addr: <strong>{{ .Source.Addr }}</strong></p>
        <p class="muted">TLS: {{ if .Source.TLS }}enabled{{ else }}disabled{{ end }}</p>
    </div>
    <div class="card">
        <div class="card-title">Target</div>
        <p class="muted">Type: <strong>{{ .Target.Type }}</strong></p>
        <p class="muted">Seed: <strong>{{ .Target.Seed }}</strong></p>
        <p class="muted">TLS: {{ if .Target.TLS }}enabled{{ else }}disabled{{ end }}</p>
    </div>
</div>

<div class="grid grid-2" style="margin-top:24px;">
    <section class="card highlight">
        <div class="card-title">Metrics overview</div>
        <div class="metrics-grid" id="metrics-list" style="margin-top:0;">
            {{ with .Snapshot }}
            {{ range $k, $v := .Metrics }}
            <div class="metric-item">
                <div class="label">{{ $k }}</div>
                <div class="value">{{ printf "%.4f" $v }}</div>
            </div>
            {{ end }}
            {{ else }}
            <p class="muted">No metrics yet.</p>
            {{ end }}
        </div>
    </section>

    <section class="card">
        <div class="card-title">Stage progress</div>
        <table class="table" id="stages-table">
            <thead><tr><th>Stage</th><th>Status</th><th>Updated</th><th>Message</th></tr></thead>
            <tbody>
            {{ with .Snapshot }}
            {{ range $name, $st := .Stages }}
            <tr class="stage-row">
                <td>{{ $name }}</td>
                <td><span class="badge">{{ $st.Status }}</span></td>
                <td>{{ $st.UpdatedAt }}</td>
                <td>{{ $st.Message }}</td>
            </tr>
            {{ end }}
            {{ else }}
            <tr><td colspan="4" class="muted">No stage data.</td></tr>
            {{ end }}
            </tbody>
        </table>
    </section>
</div>

<div class="grid grid-2" style="margin-top:24px;">
    <section class="card">
        <div class="card-title">Sync Flow Visualization</div>
        <div class="flow-diagram" id="flow-diagram">
            <div class="flow-step" data-status="completed">
                <div class="flow-node">
                    <div class="flow-header">
                        <div class="flow-icon">ğŸ¤</div>
                        <div class="flow-label">Handshake</div>
                    </div>
                    <div class="flow-description">Establishing connection with Dragonfly</div>
                    <div class="flow-status">Status: <span class="status-text">Completed âœ“</span></div>
                </div>
                <div class="flow-connector"></div>
            </div>
            <div class="flow-step" data-status="completed">
                <div class="flow-node">
                    <div class="flow-header">
                        <div class="flow-icon">ğŸ“¦</div>
                        <div class="flow-label">RDB Snapshot</div>
                    </div>
                    <div class="flow-description">Full data transfer from source</div>
                    <div class="flow-status">Loaded: <span class="status-value" data-metric="target.keys.initial">--</span> keys</div>
                </div>
                <div class="flow-connector"></div>
            </div>
            <div class="flow-step" data-status="active">
                <div class="flow-node">
                    <div class="flow-header">
                        <div class="flow-icon">ğŸ“</div>
                        <div class="flow-label">Journal Stream (Continuous)</div>
                    </div>
                    <div class="flow-description">Real-time incremental replication</div>
                    <div class="flow-status">Applied: <span class="status-value" data-metric="sync.incremental.ops.success">--</span> operations</div>
                </div>
                <div class="flow-connector"></div>
            </div>
            <div class="flow-step" data-status="pending">
                <div class="flow-node">
                    <div class="flow-header">
                        <div class="flow-icon">âœ…</div>
                        <div class="flow-label">Sync Complete</div>
                    </div>
                    <div class="flow-description">Manually stopped by user</div>
                    <div class="flow-status">Status: <span class="status-text">Standby</span></div>
                </div>
            </div>
        </div>
    </section>

    <section class="card">
        <div class="card-title">Event Stream</div>
        <div class="events" id="events-list">
            {{ with .Snapshot }}
            {{ if .Events }}
                {{ range .Events }}
                <div class="event-item">
                    <div>
                        <div class="badge" style="background:rgba(99,102,241,0.16);color:var(--accent);">{{ .Type }}</div>
                        <div style="margin-top:6px;">{{ .Message }}</div>
                    </div>
                    <time>{{ .Timestamp }}</time>
                </div>
                {{ end }}
            {{ else }}
                <p class="muted">No events yet.</p>
            {{ end }}
            {{ else }}
            <p class="muted">No events yet.</p>
            {{ end }}
        </div>
    </section>
</div>
{{ end }}

{{ define "scripts" }}{{ end }}
