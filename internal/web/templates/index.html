{{ define "content" }}
<div class="hero">
    <div>
        <h1>df2redis å®æ—¶ä»ªè¡¨ç›˜</h1>
        <p class="muted">è½»æ¾æ´å¯Ÿè¿ç§»è¿›ç¨‹ã€åŒå†™çŠ¶æ€ä¸åˆ‡æ¢å‡†å¤‡åº¦</p>
    </div>
    <div class="meta" style="margin-top:18px;">
        <div class="meta-item">ğŸ—„ï¸ æºï¼š<strong>{{ .Source.Type }} @ {{ .Source.Addr }}</strong></div>
        <div class="meta-item">ğŸ¯ ç›®æ ‡ï¼š<strong>{{ .Target.Type }} @ {{ .Target.Seed }}</strong></div>
        <div class="meta-item">ğŸ”€ ä»£ç†ï¼š<strong>{{ .Proxy.Endpoint }}</strong></div>
    </div>
    <div class="meta" style="margin-top:12px;">
        <div class="meta-item">ğŸ—‚ï¸ çŠ¶æ€ç›®å½•ï¼š<strong>{{ .StateDir }}</strong></div>
        <div class="meta-item">ğŸ“ çŠ¶æ€æ–‡ä»¶ï¼š<strong>{{ .StatusFile }}</strong></div>
        <div class="meta-item">â±ï¸ é¡µé¢ç”Ÿæˆï¼š<strong>{{ .GeneratedAt }}</strong></div>
    </div>
</div>

<div class="grid grid-3" style="margin-top:24px;">
    <div class="card highlight">
        <div class="card-title">Pipeline</div>
        <div class="state-badge" id="pipeline-status">{{ with .Snapshot }}{{ .PipelineStatus }}{{ else }}å¾…å¯åŠ¨{{ end }}</div>
        <p class="muted" style="margin-top:12px;">æœ€è¿‘åˆ·æ–°ï¼š<span id="pipeline-updated">{{ with .Snapshot }}{{ .UpdatedAt }}{{ else }}--{{ end }}</span></p>
    </div>
    <div class="card">
        <div class="card-title">æºç«¯</div>
        <p class="muted">ç±»å‹ï¼š<strong>{{ .Source.Type }}</strong></p>
        <p class="muted">åœ°å€ï¼š<strong>{{ .Source.Addr }}</strong></p>
        <p class="muted">TLSï¼š{{ if .Source.TLS }}å¯ç”¨{{ else }}å…³é—­{{ end }}</p>
    </div>
    <div class="card">
        <div class="card-title">ç›®æ ‡é›†ç¾¤</div>
        <p class="muted">ç±»å‹ï¼š<strong>{{ .Target.Type }}</strong></p>
        <p class="muted">Seedï¼š<strong>{{ .Target.Seed }}</strong></p>
        <p class="muted">TLSï¼š{{ if .Target.TLS }}å¯ç”¨{{ else }}å…³é—­{{ end }}</p>
    </div>
</div>

<div class="grid grid-2" style="margin-top:24px;">
    <section class="card highlight">
        <div class="card-title">æŒ‡æ ‡æ¦‚è§ˆ</div>
        <canvas id="metricsChart" height="160"></canvas>
        <div class="metrics-grid" id="metrics-list" style="margin-top:18px;">
            {{ with .Snapshot }}
            {{ range $k, $v := .Metrics }}
            <div class="metric-item">
                <div class="label">{{ $k }}</div>
                <div class="value">{{ printf "%.4f" $v }}</div>
            </div>
            {{ end }}
            {{ else }}
            <p class="muted">æš‚æ— æŒ‡æ ‡ã€‚</p>
            {{ end }}
        </div>
    </section>

    <section class="card">
        <div class="card-title">é˜¶æ®µè¿›åº¦</div>
        <table class="table" id="stages-table">
            <thead><tr><th>é˜¶æ®µ</th><th>çŠ¶æ€</th><th>æ—¶é—´</th><th>è¯´æ˜</th></tr></thead>
            <tbody>
            {{ with .Snapshot }}
            {{ range $name, $st := .Stages }}
            <tr class="stage-row">
                <td>{{ $name }}</td>
                <td><span class="badge">{{ $st.Status }}</span></td>
                <td>{{ $st.UpdatedAt }}</td>
                <td>{{ $st.Message }}</td>
            </tr>
            {{ end }}
            {{ else }}
            <tr><td colspan="4" class="muted">å°šæ— é˜¶æ®µä¿¡æ¯</td></tr>
            {{ end }}
            </tbody>
        </table>
    </section>
</div>

<section class="card" style="margin-top:24px;">
    <div class="card-title">äº‹ä»¶è¿½è¸ª</div>
    <div class="events" id="events-list">
        {{ with .Snapshot }}
        {{ if .Events }}
            {{ range .Events }}
            <div class="event-item">
                <div>
                    <div class="badge" style="background:rgba(99,102,241,0.16);color:var(--accent);">{{ .Type }}</div>
                    <div style="margin-top:6px;">{{ .Message }}</div>
                </div>
                <time>{{ .Timestamp }}</time>
            </div>
            {{ end }}
        {{ else }}
            <p class="muted">æš‚æ— äº‹ä»¶è®°å½•ã€‚</p>
        {{ end }}
        {{ else }}
        <p class="muted">æš‚æ— äº‹ä»¶è®°å½•ã€‚</p>
        {{ end }}
    </div>
</section>
{{ end }}

{{ define "scripts" }}{{ end }}
